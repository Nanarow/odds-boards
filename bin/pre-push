#!/bin/bash

set -e

echo "ğŸ“¥ Checking code before pushing..."

# Static analysis with Brakeman
if [ -x "bin/brakeman" ]; then
  echo "ğŸ” Running Brakeman..."
  bin/brakeman --no-pager
else
  echo "âš ï¸ bin/brakeman not found or not executable. Skipping Brakeman scan."
fi

# Lint with RuboCop
if [ -x "bin/rubocop" ]; then
  echo "ğŸ§¼ Running RuboCop..."
  bin/rubocop
else
  echo "âš ï¸ bin/rubocop not found or not executable. Skipping RuboCop lint."
fi

# Prepare DB for testing
echo "ğŸ—„ï¸ Preparing test database..."
RAILS_ENV=test bin/rails db:create db:migrate || true

# Run tests with RSpec
echo "ğŸ§ª Running RSpec tests..."
bundle exec rspec -fd

echo "âœ… Pre-push checks passed!"